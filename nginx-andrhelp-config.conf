# Nginx configuration for ANDRHELP WebSocket proxy
# This should be added to /etc/nginx/sites-available/mail.s0me.uk
# or included in the server block

location /andrhelp-ws {
    # WebSocket upgrade headers
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    
    # Standard proxy headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # WebSocket specific settings
    proxy_read_timeout 86400;  # 24 hours for long-lived connections
    proxy_send_timeout 86400;
    
    # Disable buffering for WebSocket
    proxy_buffering off;
    
    # Proxy to backend container
    proxy_pass http://localhost:3100;
    
    # Error handling
    proxy_intercept_errors off;
}

# Alternative: if you need the trailing slash version
location /andrhelp-ws/ {
    # WebSocket upgrade headers
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    
    # Standard proxy headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # WebSocket specific settings
    proxy_read_timeout 86400;
    proxy_send_timeout 86400;
    
    # Disable buffering for WebSocket
    proxy_buffering off;
    
    # Proxy to backend container (note: trailing slash handling)
    proxy_pass http://localhost:3100/;
    
    # Error handling
    proxy_intercept_errors off;
}

